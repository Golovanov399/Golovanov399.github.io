var width = document.getElementById("myCanvas").width;
var height = document.getElementById("myCanvas").height;

const Point = (x, y) => ({x, y});

const list = {
	items: null,
	add(item) { this.items.push(item); return item },
	eachItem(callback) {
		var i = 0;
		while (i < this.items.length) {
			callback(this.items[i], i++);
		}
	}
}

function createList(extend) {
	return Object.assign({}, list, {items: []}, extend);
}

function d2(p1, p2) {
	return (p1.x - p2.x) * (p1.x - p2.x) + (p1.y - p2.y) * (p1.y - p2.y);
}

function getClosestPoint(from, minDist) {
	var closestPoint;
	this.eachItem(point => {
		const dist = Math.hypot(from.x - point.x, from.y - point.y);
		if (dist < minDist) {
			closestPoint = point;
			minDist = dist;
		}
	});
	return closestPoint;
}

const Line = (p1, p2, len) => ({p1, p2, len});

const canvas = document.getElementById("myCanvas");
const ctx = canvas.getContext("2d");
const setStyle = (style) => eachOf(Object.keys(style), key => { ctx[key] = style[key] });
const eachOf = (array, callback) => {var i = 0; while (i < array.length && callback(array[i], i++) !== true); };

function drawPoint(point) {
	ctx.moveTo(point.x, point.y);
	ctx.rect(point.x - 2, point.y - 2, 4, 4);
}

function drawLine(line) {
	ctx.moveTo(pts.items[line.p1].x, pts.items[line.p1].y);
	ctx.lineTo(pts.items[line.p2].x, pts.items[line.p2].y);
}

function drawLines() { this.eachItem(line => drawLine(line)) }
function drawPoints() { this.eachItem(point => drawPoint(point)) }

const pts = createList({getClosest: getClosestPoint, draw: drawPoints});
const lines = createList({draw: drawLines});

const mouse = {x: 0, y: 0, button: false, drag: false, dragStart: false, dragEnd: false, dragStartX: 0, dragStartY: 0}
function mouseEvents(e) {
	mouse.x = e.pageX - canvas.offsetLeft;
	mouse.y = e.pageY - canvas.offsetTop;
	const lb = mouse.button;
	mouse.button = e.type === "mousedown" ? true : e.type === "mouseup" ? false : mouse.button;
	if (lb !== mouse.button) {
		if (mouse.button) {
			mouse.drag = true;
			mouse.dragStart = true;
			mouse.dragStartX = mouse.x;
			mouse.dragStartY = mouse.y;
		} else {
			mouse.drag = false;
			mouse.dragEnd = true;
		}
	}
}

["down", "up", "move"].forEach(name => document.addEventListener("mouse" + name, mouseEvents));

const tasks = JSON.parse('{"1": {"hole": [[45, 80], [35, 95], [5, 95], [35, 50], [5, 5], [35, 5], [95, 95], [65, 95], [55, 80]], "epsilon": 150000, "figure": {"edges": [[2, 5], [5, 4], [4, 1], [1, 0], [0, 8], [8, 3], [3, 7], [7, 11], [11, 13], [13, 12], [12, 18], [18, 19], [19, 14], [14, 15], [15, 17], [17, 16], [16, 10], [10, 6], [6, 2], [8, 12], [7, 9], [9, 3], [8, 9], [9, 12], [13, 9], [9, 11], [4, 8], [12, 14], [5, 10], [10, 15]], "vertices": [[20, 30], [20, 40], [30, 95], [40, 15], [40, 35], [40, 65], [40, 95], [45, 5], [45, 25], [50, 15], [50, 70], [55, 5], [55, 25], [60, 15], [60, 35], [60, 65], [60, 95], [70, 95], [80, 30], [80, 40]]}}, "2": {"hole": [[15, 60], [15, 25], [5, 25], [5, 5], [15, 5], [15, 10], [25, 10], [25, 5], [35, 5], [35, 10], [45, 10], [45, 5], [55, 5], [55, 10], [65, 10], [65, 5], [75, 5], [75, 25], [65, 25], [65, 60]], "epsilon": 250000, "figure": {"edges": [[2, 0], [0, 1], [1, 4], [4, 2], [4, 11], [11, 18], [18, 21], [21, 15], [15, 11], [2, 3], [3, 8], [8, 19], [19, 15], [9, 10], [10, 6], [6, 7], [7, 12], [12, 16], [16, 17], [17, 13], [13, 14], [14, 20], [20, 22], [22, 16], [16, 9], [3, 5], [5, 9], [22, 19], [19, 23], [23, 27], [27, 26], [26, 22], [31, 28], [28, 24], [24, 25], [25, 32], [32, 34], [34, 33], [33, 29], [29, 30], [30, 35], [35, 36], [36, 34], [34, 31], [31, 26], [36, 38], [38, 37], [37, 27]], "vertices": [[3, 7], [5, 2], [6, 16], [8, 30], [13, 10], [13, 46], [16, 56], [16, 58], [17, 33], [20, 50], [20, 55], [22, 11], [23, 58], [24, 60], [24, 62], [25, 18], [27, 51], [28, 56], [30, 6], [30, 23], [30, 62], [32, 10], [34, 51], [42, 24], [53, 51], [53, 53], [54, 45], [57, 21], [57, 50], [57, 56], [57, 58], [58, 46], [59, 53], [60, 55], [62, 48], [63, 58], [66, 48], [68, 23], [74, 32]]}}, "3": {"hole": [[50, 70], [35, 75], [35, 65], [15, 55], [30, 45], [25, 30], [30, 30], [30, 15], [45, 25], [55, 35], [55, 15], [65, 20], [80, 5], [85, 25], [90, 25], [80, 45], [95, 45], [105, 50], [100, 65], [85, 70], [90, 85], [65, 80], [60, 85], [55, 70], [50, 110], [45, 110]], "epsilon": 180000, "figure": {"edges": [[9, 17], [17, 22], [22, 27], [27, 19], [19, 14], [14, 8], [8, 9], [22, 28], [28, 30], [9, 6], [6, 4], [19, 23], [23, 24], [24, 20], [20, 21], [14, 10], [10, 11], [11, 15], [15, 16], [23, 29], [29, 32], [10, 7], [7, 2], [24, 33], [33, 35], [11, 3], [3, 0], [21, 25], [25, 26], [26, 18], [18, 13], [13, 12], [12, 16], [15, 5], [5, 1], [20, 31], [31, 34], [16, 21]], "vertices": [[15, 70], [25, 100], [30, 35], [30, 55], [35, 10], [35, 75], [40, 25], [40, 40], [45, 35], [50, 25], [50, 50], [50, 60], [50, 75], [50, 95], [55, 45], [55, 65], [55, 70], [60, 20], [60, 105], [65, 45], [65, 65], [65, 70], [70, 25], [70, 50], [70, 60], [70, 75], [70, 95], [75, 35], [80, 25], [80, 40], [85, 10], [85, 75], [90, 35], [90, 55], [95, 100], [105, 70]]}}, "4": {"hole": [[5, 5], [35, 15], [65, 15], [95, 5], [95, 50], [70, 70], [70, 90], [50, 95], [30, 90], [30, 70], [5, 50]], "epsilon": 200000, "figure": {"edges": [[22, 31], [31, 19], [19, 22], [31, 37], [37, 11], [11, 19], [11, 5], [37, 40], [10, 9], [9, 12], [12, 17], [17, 20], [20, 21], [21, 18], [18, 13], [13, 10], [33, 36], [36, 35], [35, 32], [32, 29], [29, 24], [24, 25], [25, 30], [30, 33], [5, 2], [42, 40], [40, 35], [24, 20], [9, 5], [6, 3], [3, 0], [0, 1], [1, 4], [4, 7], [14, 15], [15, 16], [16, 27], [27, 23], [23, 26], [26, 14], [15, 23], [41, 38], [38, 34], [7, 8], [27, 28], [38, 39], [42, 39], [39, 28], [28, 8], [8, 2]], "vertices": [[10, 10], [10, 25], [10, 35], [15, 5], [15, 30], [20, 50], [30, 5], [30, 30], [30, 35], [30, 50], [30, 55], [30, 65], [35, 45], [35, 60], [40, 5], [40, 20], [40, 30], [40, 45], [40, 60], [40, 80], [45, 50], [45, 55], [50, 95], [55, 20], [55, 50], [55, 55], [60, 5], [60, 30], [60, 35], [60, 45], [60, 60], [60, 80], [65, 45], [65, 60], [70, 5], [70, 50], [70, 55], [70, 65], [80, 30], [80, 35], [80, 50], [90, 5], [90, 35]]}}, "5": {"hole": [[25, 50], [30, 29], [45, 11], [58, 11], [73, 29], [77, 50], [94, 57], [99, 71], [84, 78], [62, 82], [41, 82], [20, 77], [5, 71], [12, 57]], "epsilon": 200000, "figure": {"edges": [[6, 21], [21, 20], [20, 16], [16, 17], [17, 8], [8, 5], [5, 6], [17, 21], [25, 27], [27, 28], [28, 33], [33, 34], [34, 26], [26, 25], [28, 26], [20, 25], [27, 32], [32, 30], [30, 11], [11, 12], [12, 16], [11, 7], [7, 12], [30, 35], [35, 37], [37, 32], [37, 40], [40, 41], [41, 42], [42, 40], [42, 43], [43, 44], [44, 39], [39, 43], [12, 2], [2, 1], [1, 0], [0, 2], [1, 4], [4, 3], [3, 9], [9, 4], [11, 18], [18, 22], [22, 23], [23, 30], [23, 24], [24, 31], [31, 29], [29, 38], [38, 36], [36, 29], [31, 38], [18, 13], [13, 15], [15, 19], [19, 10], [10, 15], [19, 14], [14, 10]], "vertices": [[18, 72], [20, 69], [22, 72], [23, 45], [25, 54], [27, 90], [28, 94], [30, 70], [31, 88], [32, 50], [33, 28], [35, 68], [35, 81], [37, 47], [39, 22], [39, 34], [41, 86], [41, 90], [42, 55], [44, 29], [44, 88], [45, 93], [50, 49], [55, 55], [57, 47], [57, 88], [57, 94], [60, 87], [61, 90], [64, 34], [65, 72], [66, 43], [68, 83], [68, 89], [69, 94], [70, 68], [72, 30], [72, 73], [74, 38], [80, 84], [81, 71], [84, 67], [85, 71], [85, 82], [89, 87]]}}, "6": {"hole": [[164, 164], [121, 189], [71, 189], [28, 164], [3, 121], [3, 71], [28, 28], [71, 3], [121, 3], [164, 28], [189, 71], [96, 96], [189, 121]], "epsilon": 150000, "figure": {"edges": [[1, 2], [2, 3], [3, 7], [7, 1], [1, 0], [0, 5], [5, 19], [19, 33], [33, 36], [36, 37], [37, 32], [32, 35], [35, 38], [38, 37], [32, 29], [29, 25], [25, 24], [24, 32], [7, 16], [16, 17], [17, 12], [12, 7], [16, 24], [9, 10], [10, 14], [14, 13], [13, 9], [21, 22], [22, 27], [27, 26], [26, 21], [5, 9], [9, 0], [33, 26], [26, 36], [4, 6], [6, 8], [8, 11], [11, 15], [15, 18], [18, 20], [20, 23], [23, 28], [28, 30], [30, 31], [31, 34], [14, 18], [22, 20]], "vertices": [[36, 86], [36, 141], [36, 156], [41, 156], [46, 131], [51, 56], [56, 116], [56, 141], [66, 116], [71, 81], [71, 96], [71, 131], [71, 156], [86, 81], [86, 96], [86, 131], [86, 141], [86, 156], [91, 116], [96, 36], [101, 116], [106, 81], [106, 96], [106, 131], [106, 141], [106, 156], [121, 81], [121, 96], [121, 131], [121, 156], [126, 116], [136, 116], [136, 141], [141, 56], [146, 131], [151, 156], [156, 86], [156, 141], [156, 156]]}}, "7": {"hole": [[65, 1], [65, 53], [38, 53], [38, 79], [11, 79], [11, 27], [38, 27], [38, 1]], "epsilon": 200000, "figure": {"edges": [[21, 16], [16, 10], [10, 9], [9, 15], [15, 20], [20, 21], [33, 27], [27, 21], [21, 20], [20, 26], [26, 32], [32, 33], [44, 39], [39, 33], [33, 32], [32, 38], [38, 43], [43, 44], [40, 34], [34, 28], [28, 27], [27, 33], [33, 39], [39, 40], [28, 22], [22, 17], [17, 16], [16, 21], [21, 27], [27, 28], [17, 11], [11, 5], [5, 4], [4, 10], [10, 16], [16, 17], [50, 45], [45, 40], [40, 39], [39, 44], [44, 49], [49, 50], [46, 41], [41, 35], [35, 34], [34, 40], [40, 45], [45, 46], [35, 29], [29, 23], [23, 22], [22, 28], [28, 34], [34, 35], [23, 18], [18, 12], [12, 11], [11, 17], [17, 22], [22, 23], [12, 6], [6, 1], [1, 0], [0, 5], [5, 11], [11, 12], [55, 51], [51, 46], [46, 45], [45, 50], [50, 54], [54, 55], [52, 47], [47, 42], [42, 41], [41, 46], [46, 51], [51, 52], [42, 36], [36, 30], [30, 29], [29, 35], [35, 41], [41, 42], [30, 24], [24, 19], [19, 18], [18, 23], [23, 29], [29, 30], [19, 13], [13, 7], [7, 6], [6, 12], [12, 18], [18, 19], [14, 8], [8, 3], [3, 2], [2, 7], [7, 13], [13, 14], [37, 31], [31, 25], [25, 24], [24, 30], [30, 36], [36, 37], [57, 53], [53, 48], [48, 47], [47, 52], [52, 56], [56, 57]], "vertices": [[7, 34], [7, 41], [7, 55], [7, 62], [13, 24], [13, 31], [13, 45], [13, 52], [13, 66], [19, 13], [19, 20], [19, 34], [19, 41], [19, 55], [19, 62], [25, 10], [25, 24], [25, 31], [25, 45], [25, 52], [31, 13], [31, 20], [31, 34], [31, 41], [31, 55], [31, 62], [38, 10], [38, 24], [38, 31], [38, 45], [38, 52], [38, 66], [44, 13], [44, 20], [44, 34], [44, 41], [44, 55], [44, 62], [50, 10], [50, 24], [50, 31], [50, 45], [50, 52], [56, 13], [56, 20], [56, 34], [56, 41], [56, 55], [56, 62], [62, 24], [62, 31], [62, 45], [62, 52], [62, 66], [68, 34], [68, 41], [68, 55], [68, 62]]}}, "8": {"hole": [[94, 75], [62, 72], [42, 96], [36, 65], [7, 53], [34, 37], [36, 6], [59, 27], [90, 19], [77, 48]], "epsilon": 200000, "figure": {"edges": [[7, 6], [6, 3], [3, 7], [3, 4], [4, 7], [7, 8], [8, 5], [5, 4], [8, 9], [9, 10], [10, 7], [7, 11], [11, 10], [11, 6], [9, 12], [12, 8], [5, 1], [1, 2], [2, 8], [2, 0], [0, 1]], "vertices": [[6, 64], [15, 50], [20, 50], [33, 57], [36, 69], [39, 84], [50, 16], [50, 74], [50, 79], [62, 84], [65, 69], [67, 57], [95, 37]]}}, "9": {"hole": [[80, 125], [70, 155], [5, 155], [5, 80], [45, 70], [5, 60], [5, 5], [75, 5], [85, 35], [95, 5], [155, 5], [155, 60], [120, 75], [155, 80], [155, 155], [90, 155]], "epsilon": 375000, "figure": {"edges": [[19, 28], [28, 26], [26, 17], [17, 16], [16, 19], [19, 21], [64, 57], [57, 52], [52, 53], [53, 67], [67, 70], [70, 57], [21, 64], [64, 77], [77, 76], [76, 63], [63, 44], [44, 40], [40, 25], [25, 13], [13, 14], [14, 15], [15, 21], [15, 12], [12, 11], [11, 14], [12, 7], [7, 5], [5, 10], [10, 8], [8, 3], [3, 1], [1, 11], [8, 11], [10, 12], [13, 6], [6, 9], [9, 2], [2, 0], [0, 4], [4, 6], [25, 24], [24, 29], [29, 23], [23, 18], [18, 24], [40, 39], [39, 43], [43, 44], [43, 46], [46, 35], [35, 34], [34, 39], [63, 65], [65, 73], [73, 71], [71, 58], [58, 65], [77, 81], [81, 89], [89, 91], [91, 93], [93, 92], [92, 89], [84, 85], [85, 88], [88, 87], [87, 84], [84, 81], [81, 78], [78, 82], [82, 81], [76, 83], [83, 90], [90, 95], [95, 94], [94, 86], [86, 80], [80, 75], [75, 79], [79, 83], [83, 86], [22, 72], [72, 74], [74, 20], [20, 22], [30, 36], [36, 37], [37, 31], [31, 30], [36, 41], [41, 42], [42, 37], [41, 49], [49, 50], [50, 42], [49, 54], [54, 55], [55, 50], [54, 61], [61, 62], [62, 55], [61, 68], [68, 69], [69, 62], [31, 20], [69, 74], [38, 33], [33, 27], [27, 32], [32, 38], [38, 45], [45, 47], [47, 51], [51, 48], [48, 45], [51, 56], [56, 60], [60, 66], [66, 59], [59, 56], [66, 72], [27, 22], [48, 49], [74, 77], [20, 14], [22, 25], [72, 63]], "vertices": [[1, 93], [6, 118], [8, 103], [8, 123], [9, 80], [9, 128], [13, 86], [13, 131], [17, 119], [19, 94], [20, 121], [22, 115], [25, 118], [33, 69], [37, 98], [42, 102], [46, 145], [48, 152], [54, 12], [54, 143], [56, 92], [58, 109], [60, 55], [61, 7], [61, 18], [61, 32], [64, 152], [65, 64], [67, 143], [68, 13], [69, 74], [69, 82], [71, 71], [72, 57], [74, 24], [75, 21], [75, 74], [75, 82], [77, 65], [78, 24], [78, 33], [81, 74], [81, 82], [82, 24], [82, 34], [82, 66], [85, 23], [85, 63], [85, 70], [87, 74], [87, 82], [88, 66], [89, 147], [91, 152], [93, 74], [93, 81], [94, 65], [95, 146], [98, 14], [98, 70], [99, 59], [99, 74], [99, 80], [101, 41], [102, 108], [103, 22], [103, 65], [104, 152], [105, 74], [105, 79], [105, 144], [106, 12], [111, 58], [112, 20], [114, 87], [125, 25], [125, 70], [125, 85], [129, 105], [130, 43], [133, 26], [133, 91], [133, 105], [138, 47], [138, 98], [138, 104], [140, 43], [144, 98], [144, 104], [145, 89], [148, 48], [148, 85], [149, 92], [152, 89], [154, 33], [159, 36]]}}, "10": {"hole": [[5, 86], [17, 27], [10, 9], [55, 5], [58, 31], [79, 45], [83, 76], [64, 71], [57, 87]], "epsilon": 200000, "figure": {"edges": [[0, 3], [3, 4], [4, 1], [1, 0], [1, 2], [2, 4], [2, 5], [5, 8], [8, 6], [6, 5], [6, 12], [12, 14], [14, 8], [12, 37], [37, 38], [38, 8], [8, 11], [11, 33], [33, 38], [11, 10], [10, 17], [17, 11], [33, 30], [30, 36], [36, 33], [17, 15], [15, 10], [30, 31], [31, 36], [15, 19], [31, 28], [19, 21], [21, 26], [26, 28], [28, 27], [27, 22], [22, 19], [38, 41], [41, 39], [39, 40], [40, 37], [40, 46], [46, 50], [50, 51], [51, 46], [51, 54], [54, 53], [53, 50], [47, 48], [48, 57], [57, 56], [56, 47], [48, 50], [41, 42], [42, 45], [45, 43], [43, 42], [43, 44], [44, 49], [49, 45], [45, 52], [52, 55], [55, 49], [12, 24], [24, 37], [24, 32], [32, 23], [23, 20], [20, 16], [16, 24], [20, 18], [18, 9], [9, 16], [18, 13], [13, 7], [7, 9], [23, 25], [25, 35], [35, 32], [35, 34], [34, 29], [29, 25]], "vertices": [[10, 76], [12, 66], [18, 56], [21, 78], [23, 67], [24, 42], [26, 34], [30, 22], [30, 48], [31, 26], [32, 71], [33, 62], [35, 33], [37, 18], [37, 41], [37, 73], [38, 31], [39, 67], [40, 21], [41, 74], [42, 24], [42, 69], [42, 80], [45, 24], [45, 32], [46, 19], [47, 69], [47, 80], [48, 74], [49, 15], [50, 68], [51, 73], [52, 30], [55, 62], [56, 17], [56, 21], [56, 70], [58, 34], [58, 48], [60, 42], [63, 39], [63, 45], [71, 53], [72, 60], [75, 63], [78, 56], [79, 31], [80, 13], [80, 16], [83, 59], [84, 22], [84, 31], [84, 47], [89, 22], [89, 31], [91, 55], [94, 13], [94, 16]]}}, "11": {"hole": [[10, 0], [10, 10], [0, 10]], "epsilon": 0, "figure": {"edges": [[0, 1], [1, 2], [2, 0]], "vertices": [[0, 0], [10, 0], [10, 10]]}}, "12": {"hole": [[28, 0], [56, 4], [0, 4]], "epsilon": 0, "figure": {"edges": [[0, 1], [0, 2], [1, 3], [2, 3]], "vertices": [[0, 20], [20, 0], [20, 40], [40, 20]]}}, "13": {"hole": [[20, 0], [40, 20], [20, 40], [0, 20]], "epsilon": 2494, "figure": {"edges": [[0, 1], [0, 2], [1, 3], [2, 3]], "vertices": [[15, 21], [34, 0], [0, 45], [19, 24]]}}, "14": {"hole": [[13, 0], [11, 2], [14, 2], [14, 4], [12, 9], [12, 4], [10, 5], [10, 10], [0, 0]], "epsilon": 0, "figure": {"edges": [[0, 1], [1, 2], [2, 0]], "vertices": [[0, 8], [6, 0], [14, 6]]}}, "15": {"hole": [[15, 0], [35, 20], [20, 44], [0, 24]], "epsilon": 1250, "figure": {"edges": [[0, 1], [0, 2], [1, 3], [2, 3], [2, 4], [3, 4]], "vertices": [[0, 20], [20, 0], [20, 40], [40, 20], [49, 45]]}}, "16": {"hole": [[0, 7], [22, 0], [36, 19], [22, 38], [0, 31]], "epsilon": 8897, "figure": {"edges": [[0, 1], [0, 2], [1, 3], [2, 4], [3, 4]], "vertices": [[8, 6], [26, 22], [21, 25], [19, 0], [0, 14]]}}, "17": {"hole": [[0, 31], [18, 0], [48, 18], [30, 48], [0, 65]], "epsilon": 11966, "figure": {"edges": [[0, 1], [0, 2], [0, 3], [1, 3], [2, 4], [3, 4]], "vertices": [[27, 36], [0, 57], [28, 0], [32, 70], [29, 35]]}}, "18": {"hole": [[34, 0], [17, 30], [10, 62], [13, 30], [0, 0]], "epsilon": 6731, "figure": {"edges": [[0, 1], [0, 3], [1, 2], [1, 3], [2, 4], [3, 4]], "vertices": [[0, 0], [0, 34], [17, 62], [30, 17], [45, 46]]}}, "19": {"hole": [[58, 0], [49, 16], [58, 19], [54, 27], [55, 37], [57, 46], [58, 56], [0, 35], [7, 28], [18, 19], [0, 18], [1, 8], [18, 8], [21, 0]], "epsilon": 0, "figure": {"edges": [[0, 1], [1, 2], [2, 0]], "vertices": [[0, 56], [13, 0], [58, 35]]}}, "20": {"hole": [[20, 0], [62, 39], [41, 56], [20, 40], [0, 20]], "epsilon": 4757, "figure": {"edges": [[0, 1], [0, 2], [1, 3], [2, 3], [2, 4], [3, 5], [4, 5]], "vertices": [[20, 12], [0, 32], [46, 1], [26, 21], [67, 17], [46, 0]]}}, "21": {"hole": [[61, 26], [39, 53], [5, 45], [0, 0]], "epsilon": 47549, "figure": {"edges": [[0, 1], [0, 2], [0, 3], [1, 2], [1, 4], [2, 3], [2, 4], [3, 5], [4, 6], [5, 6]], "vertices": [[0, 18], [29, 0], [29, 34], [40, 69], [59, 17], [71, 70], [85, 41]]}}, "22": {"hole": [[30, 0], [64, 1], [94, 18], [64, 35], [29, 35], [0, 18]], "epsilon": 30202, "figure": {"edges": [[0, 1], [0, 2], [1, 2], [1, 4], [2, 3], [3, 4], [3, 5], [4, 5]], "vertices": [[29, 67], [32, 34], [0, 47], [32, 34], [26, 0], [0, 22]]}}, "23": {"hole": [[0, 0], [30, 17], [60, 41], [41, 72], [10, 69], [0, 34]], "epsilon": 8317, "figure": {"edges": [[0, 1], [0, 3], [1, 2], [1, 3], [2, 4], [3, 5], [4, 5]], "vertices": [[0, 0], [0, 34], [10, 69], [30, 17], [39, 80], [54, 47]]}}, "24": {"hole": [[34, 1], [60, 0], [68, 28], [20, 64], [0, 44]], "epsilon": 8828, "figure": {"edges": [[0, 1], [0, 2], [1, 3], [1, 4], [2, 4], [3, 5], [4, 6], [5, 6]], "vertices": [[33, 80], [25, 53], [25, 53], [24, 26], [0, 40], [22, 0], [30, 28]]}}, "25": {"hole": [[0, 20], [28, 0], [55, 61], [40, 96], [7, 91], [0, 54]], "epsilon": 16310, "figure": {"edges": [[0, 1], [0, 3], [0, 4], [1, 2], [1, 4], [2, 5], [3, 4], [4, 6], [5, 6]], "vertices": [[18, 2], [52, 0], [16, 11], [0, 31], [37, 31], [47, 24], [14, 5]]}}, "26": {"hole": [[17, 17], [46, 0], [76, 17], [80, 51], [26, 65], [0, 46]], "epsilon": 15671, "figure": {"edges": [[0, 1], [0, 2], [1, 3], [1, 4], [2, 4], [2, 6], [3, 4], [3, 5], [4, 5], [4, 6], [5, 6]], "vertices": [[64, 0], [34, 15], [53, 30], [53, 43], [19, 45], [34, 14], [0, 12]]}}, "27": {"hole": [[28, 0], [31, 5], [40, 6], [40, 16], [35, 19], [24, 14], [25, 21], [25, 27], [26, 34], [28, 40], [17, 39], [0, 40], [10, 33], [18, 28], [10, 24], [2, 24], [7, 15], [0, 13], [0, 0], [10, 0], [17, 1]], "epsilon": 2500, "figure": {"edges": [[0, 1], [0, 2], [1, 3], [2, 3]], "vertices": [[0, 20], [20, 0], [20, 40], [40, 20]]}}, "28": {"hole": [[0, 0], [14, 0], [16, 7], [26, 6], [20, 0], [31, 0], [40, 7], [40, 17], [35, 21], [29, 14], [20, 16], [18, 22], [16, 29], [31, 27], [40, 27], [40, 34], [28, 40], [25, 34], [17, 36], [8, 40], [11, 22], [0, 32], [0, 23], [1, 8]], "epsilon": 1250, "figure": {"edges": [[0, 1], [0, 2], [1, 3], [2, 3]], "vertices": [[0, 20], [20, 0], [20, 40], [40, 20]]}}, "29": {"hole": [[3, 0], [9, 0], [9, 8], [12, 16], [18, 4], [19, 18], [28, 6], [32, 0], [40, 0], [36, 7], [37, 14], [35, 22], [25, 21], [27, 27], [30, 34], [26, 41], [18, 32], [17, 40], [8, 41], [0, 41], [3, 33], [0, 27], [6, 26], [6, 20], [0, 11], [0, 5]], "epsilon": 2500, "figure": {"edges": [[0, 1], [0, 2], [1, 3], [2, 3]], "vertices": [[0, 20], [20, 0], [20, 40], [40, 20]]}}, "30": {"hole": [[14, 10], [21, 6], [28, 1], [36, 0], [44, 0], [43, 8], [44, 16], [44, 24], [39, 35], [30, 40], [39, 43], [27, 49], [20, 49], [10, 43], [2, 39], [0, 32], [0, 5], [7, 12]], "epsilon": 1249, "figure": {"edges": [[0, 1], [0, 2], [1, 3], [1, 4], [2, 3], [3, 4]], "vertices": [[24, 0], [0, 15], [44, 20], [20, 35], [24, 6]]}}, "31": {"hole": [[32, 0], [57, 20], [51, 27], [46, 37], [57, 39], [56, 50], [57, 66], [44, 69], [26, 69], [35, 58], [28, 46], [17, 54], [0, 57], [2, 47], [2, 37], [8, 28], [0, 18], [0, 6], [9, 6], [20, 4]], "epsilon": 13457, "figure": {"edges": [[0, 1], [0, 4], [1, 2], [1, 3], [1, 4], [2, 3], [3, 4]], "vertices": [[0, 0], [0, 34], [0, 69], [27, 51], [30, 17]]}}, "32": {"hole": [[14, 20], [12, 13], [8, 8], [8, 0], [17, 3], [23, 0], [29, 2], [32, 7], [36, 11], [36, 18], [20, 10], [25, 20], [27, 29], [23, 35], [22, 41], [14, 41], [8, 35], [0, 30], [5, 26], [2, 17]], "epsilon": 9381, "figure": {"edges": [[0, 1], [0, 2], [1, 3], [2, 4], [3, 4]], "vertices": [[0, 7], [0, 31], [22, 0], [22, 38], [36, 19]]}}, "33": {"hole": [[0, 19], [1, 8], [0, 0], [24, 0], [26, 12], [36, 4], [33, 17], [36, 25], [36, 43], [34, 51], [36, 60], [34, 71], [27, 61], [20, 64], [12, 71], [0, 71], [0, 63], [1, 47], [0, 37], [2, 28]], "epsilon": 15533, "figure": {"edges": [[0, 2], [0, 4], [1, 2], [1, 3], [2, 3], [2, 4], [3, 4]], "vertices": [[14, 34], [34, 2], [0, 0], [15, 31], [36, 3]]}}, "34": {"hole": [[0, 41], [21, 27], [69, 0], [89, 20], [69, 40], [28, 73], [0, 69]], "epsilon": 20152, "figure": {"edges": [[0, 1], [0, 2], [1, 3], [2, 4], [2, 5], [3, 4], [4, 5], [4, 7], [5, 6], [5, 7], [6, 8], [7, 8]], "vertices": [[10, 0], [8, 28], [33, 11], [0, 55], [9, 27], [34, 40], [57, 24], [10, 55], [35, 42]]}}, "35": {"hole": [[0, 7], [22, 0], [62, 26], [54, 48], [39, 55], [15, 61], [0, 31]], "epsilon": 24912, "figure": {"edges": [[0, 1], [0, 3], [1, 4], [2, 4], [2, 6], [3, 5], [4, 5], [4, 6], [5, 8], [6, 7], [7, 8]], "vertices": [[53, 0], [30, 7], [0, 15], [55, 23], [20, 28], [35, 10], [22, 4], [17, 20], [33, 37]]}}, "36": {"hole": [[23, 0], [32, 2], [24, 6], [31, 9], [36, 12], [36, 26], [29, 18], [24, 22], [21, 27], [30, 32], [18, 34], [10, 38], [12, 30], [6, 28], [0, 32], [0, 20], [8, 22], [5, 14], [1, 6], [0, 0], [6, 0], [12, 3], [17, 0]], "epsilon": 15010, "figure": {"edges": [[0, 1], [0, 2], [1, 3], [2, 4], [3, 4]], "vertices": [[0, 7], [0, 31], [22, 0], [22, 38], [36, 19]]}}, "37": {"hole": [[54, 0], [54, 9], [52, 18], [49, 26], [54, 34], [54, 43], [45, 47], [40, 36], [28, 47], [14, 47], [15, 39], [7, 32], [0, 24], [4, 17], [0, 8], [0, 0]], "epsilon": 16994, "figure": {"edges": [[0, 1], [0, 2], [0, 5], [1, 2], [1, 3], [2, 4], [2, 5], [3, 4], [4, 5]], "vertices": [[48, 2], [54, 29], [27, 20], [27, 20], [7, 0], [0, 27]]}}, "38": {"hole": [[0, 0], [50, 9], [68, 54], [47, 64], [0, 16]], "epsilon": 57852, "figure": {"edges": [[0, 3], [3, 7], [7, 4], [4, 0], [7, 10], [10, 9], [9, 8], [8, 7], [4, 5], [5, 8], [8, 6], [6, 1], [1, 5], [5, 2], [2, 4]], "vertices": [[0, 11], [1, 85], [8, 56], [11, 0], [14, 45], [14, 59], [14, 88], [30, 37], [30, 56], [56, 85], [67, 64]]}}, "39": {"hole": [[5, 7], [39, 0], [59, 33], [56, 76], [45, 110], [6, 111], [0, 73], [0, 39]], "epsilon": 20037, "figure": {"edges": [[0, 1], [0, 2], [0, 4], [1, 3], [1, 4], [2, 5], [3, 6], [4, 7], [4, 8], [5, 8], [6, 7], [7, 8]], "vertices": [[4, 8], [6, 42], [23, 34], [37, 19], [35, 23], [16, 0], [5, 42], [38, 56], [0, 35]]}}, "40": {"hole": [[32, 0], [43, 6], [52, 0], [64, 3], [64, 19], [60, 35], [55, 43], [64, 53], [53, 56], [60, 66], [36, 66], [23, 67], [3, 67], [2, 54], [1, 37], [0, 21], [0, 5], [11, 0], [22, 1]], "epsilon": 13279, "figure": {"edges": [[0, 1], [0, 2], [0, 3], [1, 2], [1, 3], [1, 4], [2, 4], [3, 5], [4, 5]], "vertices": [[28, 0], [23, 32], [34, 64], [56, 16], [0, 58], [21, 29]]}}, "41": {"hole": [[1, 0], [15, 1], [37, 49], [17, 87], [0, 27]], "epsilon": 151751, "figure": {"edges": [[0, 1], [0, 3], [0, 4], [0, 8], [1, 2], [1, 4], [2, 7], [3, 4], [3, 5], [4, 6], [5, 8], [5, 9], [6, 7], [6, 9], [6, 10], [7, 10], [8, 11], [9, 10], [9, 11], [10, 11]], "vertices": [[0, 33], [11, 64], [23, 82], [24, 21], [24, 45], [46, 14], [46, 52], [47, 78], [60, 0], [60, 33], [69, 56], [75, 16]]}}, "42": {"hole": [[0, 5], [6, 0], [34, 0], [36, 8], [43, 15], [48, 0], [56, 2], [56, 42], [52, 49], [45, 53], [37, 52], [28, 53], [19, 52], [7, 53], [11, 40], [0, 43]], "epsilon": 50378, "figure": {"edges": [[0, 1], [0, 2], [1, 3], [1, 5], [2, 4], [2, 6], [3, 4], [3, 5], [4, 6], [5, 6]], "vertices": [[26, 21], [48, 10], [25, 44], [25, 7], [10, 25], [0, 20], [10, 0]]}}, "43": {"hole": [[53, 0], [100, 22], [66, 68], [43, 68], [0, 41]], "epsilon": 40000, "figure": {"edges": [[7, 6], [6, 3], [3, 7], [3, 4], [4, 7], [7, 8], [8, 5], [5, 4], [8, 9], [9, 10], [10, 7], [7, 11], [11, 10], [11, 6], [9, 12], [12, 8], [5, 1], [1, 2], [2, 8], [2, 0], [0, 1]], "vertices": [[0, 48], [9, 34], [14, 34], [27, 41], [30, 53], [33, 68], [44, 0], [44, 58], [44, 63], [56, 68], [59, 53], [61, 41], [89, 21]]}}, "44": {"hole": [[22, 0], [21, 13], [43, 8], [18, 45], [57, 13], [57, 31], [48, 41], [61, 45], [74, 42], [75, 89], [63, 79], [48, 89], [49, 72], [61, 59], [43, 53], [36, 70], [25, 84], [15, 76], [4, 89], [1, 72], [0, 51], [6, 40], [13, 30], [0, 25], [4, 13], [5, 1]], "epsilon": 41631, "figure": {"edges": [[0, 1], [0, 3], [1, 2], [1, 3], [2, 4], [3, 5], [4, 5]], "vertices": [[10, 10], [10, 44], [18, 77], [40, 27], [51, 79], [65, 50]]}}, "45": {"hole": [[14, 0], [24, 13], [15, 27], [27, 30], [42, 18], [31, 0], [45, 1], [60, 7], [60, 20], [45, 30], [54, 36], [42, 47], [57, 51], [59, 62], [60, 74], [50, 74], [49, 62], [24, 74], [10, 74], [13, 60], [2, 56], [4, 46], [14, 41], [3, 32], [1, 21], [5, 7]], "epsilon": 32891, "figure": {"edges": [[0, 1], [0, 3], [1, 2], [1, 3], [2, 4], [3, 5], [4, 5]], "vertices": [[0, 0], [0, 34], [5, 72], [30, 17], [43, 74], [60, 40]]}}, "46": {"hole": [[24, 32], [65, 0], [85, 20], [78, 61], [53, 91], [2, 89], [0, 60]], "epsilon": 137031, "figure": {"edges": [[0, 1], [0, 2], [0, 3], [1, 4], [1, 6], [2, 3], [2, 5], [2, 8], [3, 4], [3, 7], [4, 6], [5, 8], [5, 9], [6, 7], [6, 10], [7, 9], [7, 10], [8, 11], [9, 10], [9, 11], [10, 11]], "vertices": [[0, 82], [22, 99], [0, 46], [25, 67], [4, 79], [18, 29], [5, 51], [32, 41], [18, 0], [14, 58], [39, 65], [21, 29]]}}, "47": {"hole": [[6, 14], [36, 19], [40, 17], [69, 0], [79, 21], [41, 36], [36, 33], [16, 44], [7, 34], [0, 28]], "epsilon": 41323, "figure": {"edges": [[0, 3], [3, 7], [7, 4], [4, 0], [7, 10], [10, 9], [9, 8], [8, 7], [4, 5], [5, 8], [8, 6], [6, 1], [1, 5], [5, 2], [2, 4]], "vertices": [[0, 11], [1, 85], [8, 56], [11, 0], [14, 45], [14, 59], [14, 88], [30, 37], [30, 56], [56, 85], [67, 64]]}}, "48": {"hole": [[23, 0], [49, 0], [60, 5], [71, 0], [71, 15], [63, 24], [55, 34], [59, 44], [71, 51], [71, 64], [70, 76], [23, 76], [0, 67], [24, 60], [26, 49], [25, 38], [13, 30], [0, 36], [2, 23], [0, 11], [11, 5]], "epsilon": 18565, "figure": {"edges": [[0, 1], [0, 2], [1, 2], [1, 3], [1, 4], [2, 6], [3, 4], [3, 5], [4, 6], [4, 7], [5, 7]], "vertices": [[42, 54], [53, 27], [24, 31], [31, 9], [26, 37], [58, 0], [0, 54], [53, 28]]}}, "49": {"hole": [[2, 24], [12, 0], [22, 0], [31, 50], [30, 61], [18, 58], [7, 44], [0, 29]], "epsilon": 164384, "figure": {"edges": [[7, 6], [6, 3], [3, 7], [3, 4], [4, 7], [7, 8], [8, 5], [5, 4], [8, 9], [9, 10], [10, 7], [7, 11], [11, 10], [11, 6], [9, 12], [12, 8], [5, 1], [1, 2], [2, 8], [2, 0], [0, 1]], "vertices": [[0, 48], [9, 34], [14, 34], [27, 41], [30, 53], [33, 68], [44, 0], [44, 58], [44, 63], [56, 68], [59, 53], [61, 41], [89, 21]]}}, "50": {"hole": [[21, 35], [0, 22], [26, 14], [0, 8], [15, 0], [45, 0], [52, 12], [52, 48], [51, 60], [49, 86], [38, 73], [17, 85], [31, 92], [24, 103], [2, 103], [0, 85], [0, 52], [8, 41]], "epsilon": 17065, "figure": {"edges": [[0, 3], [0, 4], [1, 2], [1, 5], [2, 3], [2, 5], [3, 6], [3, 7], [4, 6], [5, 8], [6, 7], [7, 8]], "vertices": [[0, 75], [7, 0], [10, 26], [20, 55], [20, 95], [29, 13], [40, 75], [46, 52], [48, 28]]}}, "51": {"hole": [[19, 19], [15, 0], [22, 15], [23, 35], [67, 38], [33, 67], [61, 91], [6, 72], [8, 59], [0, 50]], "epsilon": 38462, "figure": {"edges": [[7, 6], [6, 3], [3, 7], [3, 4], [4, 7], [7, 8], [8, 5], [5, 4], [8, 9], [9, 10], [10, 7], [7, 11], [11, 10], [11, 6], [9, 12], [12, 8], [5, 1], [1, 2], [2, 8], [2, 0], [0, 1]], "vertices": [[0, 48], [9, 34], [14, 34], [27, 41], [30, 53], [33, 68], [44, 0], [44, 58], [44, 63], [56, 68], [59, 53], [61, 41], [89, 21]]}}, "52": {"hole": [[13, 23], [58, 0], [79, 10], [76, 36], [62, 62], [50, 80], [25, 82], [3, 75], [0, 44]], "epsilon": 40173, "figure": {"edges": [[0, 3], [0, 4], [1, 2], [1, 4], [2, 5], [3, 4], [3, 6], [4, 6], [4, 7], [4, 9], [5, 7], [6, 9], [6, 10], [7, 8], [7, 9], [7, 11], [8, 11], [9, 11], [9, 12], [10, 13], [12, 13]], "vertices": [[30, 43], [46, 24], [45, 0], [44, 23], [55, 45], [33, 20], [27, 43], [31, 44], [35, 64], [38, 67], [0, 39], [53, 52], [49, 46], [23, 42]]}}, "53": {"hole": [[41, 0], [142, 67], [136, 96], [102, 116], [51, 93], [20, 63], [0, 43]], "epsilon": 26846, "figure": {"edges": [[0, 1], [0, 2], [0, 3], [1, 3], [1, 4], [2, 3], [2, 6], [3, 6], [3, 7], [4, 7], [5, 6], [5, 8], [5, 9], [6, 9], [7, 10], [8, 9], [8, 12], [9, 10], [9, 12], [10, 13], [11, 12], [11, 14], [12, 13], [12, 14], [13, 15], [14, 15]], "vertices": [[20, 54], [25, 26], [48, 59], [53, 31], [50, 45], [10, 16], [24, 36], [82, 38], [22, 35], [44, 22], [73, 8], [0, 25], [26, 0], [45, 24], [38, 34], [23, 8]]}}, "54": {"hole": [[14, 9], [14, 14], [23, 26], [64, 11], [45, 51], [35, 58], [81, 68], [23, 68], [21, 55], [10, 50], [0, 0]], "epsilon": 42736, "figure": {"edges": [[7, 6], [6, 3], [3, 7], [3, 4], [4, 7], [7, 8], [8, 5], [5, 4], [8, 9], [9, 10], [10, 7], [7, 11], [11, 10], [11, 6], [9, 12], [12, 8], [5, 1], [1, 2], [2, 8], [2, 0], [0, 1]], "vertices": [[0, 48], [9, 34], [14, 34], [27, 41], [30, 53], [33, 68], [44, 0], [44, 58], [44, 63], [56, 68], [59, 53], [61, 41], [89, 21]]}}, "55": {"hole": [[14, 0], [38, 6], [58, 33], [10, 98], [0, 96]], "epsilon": 40000, "figure": {"edges": [[2, 5], [5, 4], [4, 1], [1, 0], [0, 8], [8, 3], [3, 7], [7, 11], [11, 13], [13, 12], [12, 18], [18, 19], [19, 14], [14, 15], [15, 17], [17, 16], [16, 10], [10, 6], [6, 2], [8, 12], [7, 9], [9, 3], [8, 9], [9, 12], [13, 9], [9, 11], [4, 8], [12, 14], [5, 10], [10, 15]], "vertices": [[0, 25], [0, 35], [10, 90], [20, 10], [20, 30], [20, 60], [20, 90], [25, 0], [25, 20], [30, 10], [30, 65], [35, 0], [35, 20], [40, 10], [40, 30], [40, 60], [40, 90], [50, 90], [60, 25], [60, 35]]}}, "56": {"hole": [[0, 34], [1, 14], [15, 13], [7, 0], [35, 0], [53, 2], [67, 12], [56, 26], [40, 34], [40, 60], [65, 54], [63, 78], [50, 83], [30, 99], [24, 77], [1, 95], [8, 72], [14, 54], [0, 56]], "epsilon": 18542, "figure": {"edges": [[0, 1], [0, 2], [1, 5], [2, 4], [2, 5], [3, 5], [3, 8], [4, 6], [4, 7], [5, 8], [5, 9], [6, 10], [7, 9], [7, 10], [8, 9]], "vertices": [[0, 32], [20, 12], [20, 52], [34, 0], [35, 74], [40, 32], [40, 102], [63, 69], [65, 12], [67, 46], [69, 95]]}}, "57": {"hole": [[55, 0], [61, 3], [68, 33], [85, 43], [107, 36], [94, 72], [101, 88], [95, 105], [70, 110], [47, 117], [53, 96], [63, 72], [39, 75], [22, 69], [19, 122], [2, 81], [0, 53], [0, 30]], "epsilon": 23327, "figure": {"edges": [[0, 1], [0, 2], [1, 4], [1, 6], [2, 5], [2, 8], [3, 4], [3, 6], [3, 7], [4, 5], [4, 7], [5, 8], [6, 9], [7, 10], [7, 11], [8, 11], [9, 10], [10, 11]], "vertices": [[0, 100], [15, 68], [29, 122], [52, 37], [52, 71], [59, 105], [61, 4], [82, 54], [94, 108], [96, 0], [104, 34], [107, 73]]}}, "58": {"hole": [[0, 4], [11, 0], [21, 12], [27, 0], [41, 1], [56, 0], [104, 0], [104, 25], [93, 29], [97, 41], [104, 53], [82, 57], [67, 57], [58, 49], [40, 57], [25, 57], [12, 53], [0, 56]], "epsilon": 29340, "figure": {"edges": [[0, 1], [0, 3], [1, 2], [2, 4], [2, 5], [3, 5], [4, 6], [5, 7], [6, 7], [6, 8], [7, 9], [8, 10], [8, 11], [9, 10], [10, 11]], "vertices": [[26, 37], [22, 12], [2, 20], [4, 21], [5, 0], [24, 29], [25, 12], [2, 19], [5, 23], [20, 34], [0, 46], [20, 40]]}}, "59": {"hole": [[12, 63], [48, 20], [68, 0], [88, 20], [88, 124], [81, 141], [55, 130], [0, 81]], "epsilon": 39400, "figure": {"edges": [[0, 1], [0, 2], [1, 3], [1, 4], [2, 4], [2, 5], [3, 6], [3, 7], [4, 5], [4, 6], [4, 8], [5, 10], [5, 11], [6, 13], [7, 12], [7, 13], [8, 11], [9, 10], [9, 15], [10, 14], [11, 14], [12, 16], [13, 16], [14, 17], [15, 17]], "vertices": [[12, 56], [28, 41], [29, 40], [52, 35], [5, 41], [15, 20], [28, 43], [23, 47], [25, 30], [11, 14], [2, 0], [14, 45], [0, 63], [39, 70], [10, 17], [14, 42], [16, 86], [26, 28]]}}}')
var task;
var eps;
var fig;
var hole;

var sz = 5;

const inf = 1e9;
var minX = inf;
var maxX = -inf;
var minY = inf;
var maxY = -inf;

function calc_score() {
	var res = 0;
	hole.forEach(p => {
		var tmp = inf;
		pts.items.forEach(pt => {
			var x = (pt.x / sz + minX) - p[0];
			var y = (pt.y / sz + minY) - p[1];
			tmp = Math.min(tmp, x * x + y * y);
		});
		res += tmp;
	});
	return Math.round(res);
}

function closestGrid(x) {
	const low = x - x % sz;
	if (x - low < low + sz - x) {
		return low;
	} else {
		return low + sz;
	}
}


function chooseTask(idx) {
	task = tasks[idx];
	eps = task["epsilon"] / 1e6;

	fig = task["figure"];
	hole = task["hole"];

	minX = inf;
	maxX = -inf;
	minY = inf;
	maxY = -inf;
	hole.forEach(p => {
		minX = Math.min(minX, p[0]);
		maxX = Math.max(maxX, p[0]);
		minY = Math.min(minY, p[1]);
		maxY = Math.max(maxY, p[1]);
	});
	fig["vertices"].forEach(p => {
		minX = Math.min(minX, p[0]);
		maxX = Math.max(maxX, p[0]);
		minY = Math.min(minY, p[1]);
		maxY = Math.max(maxY, p[1]);
	});
	minX -= 1;
	maxX += 1;
	minY -= 1;
	maxY += 1;

	w = canvas.width = (maxX - minX) * sz;
	h = canvas.height = (maxY - minY) * sz;

	pts.items = [];
	lines.items = [];
	fig["vertices"].forEach(pt => { pts.add(Point((pt[0] - minX) * sz, (pt[1] - minY) * sz)) });
	fig["edges"].forEach(uv => { lines.add(Line(uv[0], uv[1], d2(pts.items[uv[0]], pts.items[uv[1]]))) });
}

chooseTask("1");
for (var i = 1; i < 60; ++i) {
	var nw = document.createElement("option");
	nw.value = "" + i;
	nw.innerHTML = "Task #" + i;
	document.getElementById("taskId").appendChild(nw);
}


var w = canvas.width;
var h = canvas.height;
var closestPoint;
var dragOffsetX;
var dragOffsetY;
var cursor;

const minDist = 20;

const shortLineStyle = {
	lineWidth: 2,
	strokeStyle: "cyan",
}
const lineStyle = {
	lineWidth: 2,
	strokeStyle: "black",
}
const longLineStyle = {
	lineWidth: 2,
	strokeStyle: "red",
}
const pointStyle = {
	lineWidth: 1,
	strokeStyle: "blue",
}
const highlightStyle = {
	lineWidth: 3,
	strokeStyle: "red",
}

function update(timer) {
	cursor = "crosshair";
	globalTime = timer;
	ctx.setTransform(1, 0, 0, 1, 0, 0);
	ctx.globalAlpha = 1;
	if (w == 0 || h == 0 || sz != document.getElementById("szRange").valueAsNumber) {
		var nsz = document.getElementById("szRange").valueAsNumber;
		w = canvas.width = (maxX - minX) * nsz;
		h = canvas.height = (maxY - minY) * nsz;
		if (pts.items.length > 0) {
			pts.eachItem(pt => {
				pt.x = Math.round(pt.x / sz * nsz);
				pt.y = Math.round(pt.y / sz * nsz);
			});
			lines.eachItem(line => {
				line.len = Math.round(line.len / sz / sz) * nsz * nsz;
			});
		} else {
			fig["vertices"].forEach(pt => { pts.add(Point((pt[0] - minX) * nsz, (pt[1] - minY) * nsz)) });
			fig["edges"].forEach(uv => { lines.add(Line(uv[0], uv[1], d2(pts.items[uv[0]], pts.items[uv[1]]))) });
		}
		sz = nsz;
	} else {
		ctx.clearRect(0, 0, w, h);
	}

	ctx.fillStyle = "#aaa";
	ctx.rect(0, 0, w, h);
	ctx.fill();
	ctx.fillStyle = "#fff";
	ctx.beginPath();
	ctx.moveTo((hole[hole.length - 1][0] - minX) * sz, (hole[hole.length - 1][1] - minY) * sz);
	hole.forEach(p => {
		ctx.lineTo((p[0] - minX) * sz, (p[1] - minY) * sz);
	});
	ctx.fill();

	if (mouse.drag === false) {
		closestPoint = pts.getClosest(mouse, minDist);
	}
	if (mouse.dragStart) {
		if (closestPoint) {
			dragOffsetX = closestPoint.x - mouse.x;
			dragOffsetY = closestPoint.y - mouse.y;
			cursor = "move";
		} else {
			mouse.drag = false;
		}
		mouse.dragStart = false;
	} else if (mouse.drag) {
		closestPoint.x = closestGrid(mouse.x + dragOffsetX);
		closestPoint.y = closestGrid(mouse.y + dragOffsetY);
		cursor = "move";

		document.getElementById("result").value = '{"vertices": [' + pts.items.map(pt => "[" + (minX + Math.round(pt.x / sz)) + ", " + (minY + Math.round(pt.y / sz)) + "]").join(", ") + ']}';
		document.getElementById("score").innerHTML = 'Score: ' + calc_score();
	}

	lines.eachItem(line => {
		const cur = d2(pts.items[line.p1], pts.items[line.p2]);
		if (cur < line.len * (1 - eps)) {
			setStyle(shortLineStyle);
		} else if (cur > line.len * (1 + eps)) {
			setStyle(longLineStyle);
		} else {
			setStyle(lineStyle);
		}
		ctx.beginPath();
		drawLine(line);
		ctx.stroke();
	});
	// setStyle(lineStyle);
	// ctx.beginPath();
	// lines.draw();
	// ctx.stroke();
	setStyle(pointStyle);
	ctx.beginPath();
	pts.draw();
	ctx.stroke();
	setStyle(highlightStyle);
	ctx.beginPath();
	if (closestPoint) {
		drawPoint(closestPoint);
	}
	ctx.stroke();

	// canvas.style.cursor = cursor;

	requestAnimationFrame(update);
}

requestAnimationFrame(update);

function copyToBuffer() {
	var text = document.getElementById("result");
	text.select();
	text.setSelectionRange(0, 99999);
	document.execCommand("copy");
	text.selectionStart = text.selectionEnd = 0;
}